<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstanceLLM Control Panel</title>
    <link rel="stylesheet" href="/static/style.css?v=2">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar for instances -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Instances</div>
                <div style="display: flex; gap: 4px;">
                    <button onclick="scanNetwork()" class="scan-network-btn" title="Scan Network">üîç</button>
                    <button onclick="showAddInstanceDialog()" class="add-instance-btn" title="Add Instance">+</button>
                </div>
            </div>
            <div id="instances-list" class="instances-list">
                <!-- Instance tiles will be added here -->
            </div>
        </div>
        
        <!-- Main window -->
        <div class="main-content">
    <div class="window">
        <div class="title-bar">
            <div class="title-bar-text">InstanceLLM Control Panel</div>
            <div class="title-bar-controls">
                <button aria-label="Minimize"></button>
                <button aria-label="Maximize"></button>
                <button aria-label="Close"></button>
            </div>
        </div>
        <div class="window-body">
            <!-- Status Section -->
            <div class="field-row-stacked status-section">
                <div class="status-bar">
                    <p class="status-bar-field">Status: <span id="server-status">Checking...</span></p>
                    <p class="status-bar-field">Model: <span id="model-name">None</span></p>
                </div>
            </div>

            <!-- Tabs -->
            <section class="tabs">
                <menu role="tablist">
                    <button role="tab" aria-selected="true" aria-controls="tab-chat" onclick="switchTab('chat')">Chat</button>
                    <button role="tab" aria-controls="tab-models" onclick="switchTab('models')">Models</button>
                    <button role="tab" aria-controls="tab-subroutines" onclick="switchTab('subroutines')">Subroutines</button>
                    <button role="tab" aria-controls="tab-settings" onclick="switchTab('settings')">Settings</button>
                </menu>

                <!-- Chat Tab -->
                <article role="tabpanel" id="tab-chat" class="active">
                    <div class="chat-container">
                        <div class="field-row-stacked">
                            <label for="chat-output">Conversation</label>
                            <div id="chat-output" class="sunken-panel chat-output"></div>
                        </div>
                        <div class="field-row">
                            <label for="prompt-input">Prompt:</label>
                            <input id="prompt-input" type="text" placeholder="Type your message here..." />
                        </div>
                        <div class="field-row" style="justify-content: space-between;">
                            <div>
                                <input type="checkbox" id="streaming-mode" checked />
                                <label for="streaming-mode">Streaming mode</label>
                            </div>
                            <button onclick="sendPrompt()" style="min-width: 100px;">Send Message</button>
                        </div>
                    </div>
                </article>

                <!-- Models Tab -->
                <article role="tabpanel" id="tab-models" style="display: none;">
                    <div class="models-container">
                        <div class="field-row" style="justify-content: space-between; margin-bottom: 12px;">
                            <label style="font-weight: bold;">Available Models</label>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="scanForModels()" style="min-width: 120px;">üîç Scan Local Models</button>
                                <button onclick="scanOnlineModels()" style="min-width: 140px;">üåê Scan Online Models</button>
                            </div>
                        </div>
                        <div class="field-row-stacked">
                            <div class="window scrollable-tiles" id="models-list">
                                <div class="loading">Loading models...</div>
                            </div>
                        </div>
                        <div class="field-row-stacked">
                            <label>Download Progress</label>
                            <div class="sunken-panel">
                                <div id="download-status">No downloads in progress</div>
                                <div id="progress-container" style="display: none; margin-top: 12px;">
                                    <div class="progress-bar-outer">
                                        <div id="progress-bar-inner" class="progress-bar-inner" style="width: 0%;"></div>
                                    </div>
                                    <div id="progress-text" style="margin-top: 6px; font-size: 10px; text-align: center;">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </article>

                <!-- Subroutines Tab -->
                <article role="tabpanel" id="tab-subroutines" style="display: none;">
                    <div class="subroutines-container">
                        <div class="field-row-stacked" style="margin-bottom: 12px;">
                            <label style="font-weight: bold;">Configure Subroutines for Active Instance</label>
                            <p style="font-size: 10px; color: #666; margin: 4px 0;">
                                Selected instance: <span id="subroutine-instance-name" style="font-weight: bold; color: #000080;">None</span>
                            </p>
                        </div>
                        
                        <fieldset>
                            <legend>Output Format</legend>
                            <div class="field-row-stacked" style="padding: 8px;">
                                <label>
                                    <input type="checkbox" id="sub-json" value="json" onchange="updateSubroutines()">
                                    <strong>{ } JSON Output</strong> - Always return valid JSON format
                                </label>
                                <label>
                                    <input type="checkbox" id="sub-xml" value="xml" onchange="updateSubroutines()">
                                    <strong>&lt; &gt; XML Output</strong> - Return responses in XML format
                                </label>
                                <label>
                                    <input type="checkbox" id="sub-markdown" value="markdown" onchange="updateSubroutines()">
                                    <strong>MD Markdown Output</strong> - Format responses in markdown
                                </label>
                                <label>
                                    <input type="checkbox" id="sub-code" value="code" onchange="updateSubroutines()">
                                    <strong>CODE Code-Only</strong> - Return only code without explanations
                                </label>
                            </div>
                        </fieldset>
                        
                        <fieldset style="margin-top: 12px;">
                            <legend>Response Style</legend>
                            <div class="field-row-stacked" style="padding: 8px;">
                                <label>
                                    <input type="checkbox" id="sub-concise" value="concise" onchange="updateSubroutines()">
                                    <strong>BRIEF Concise Mode</strong> - Brief, direct answers only
                                </label>
                                <label>
                                    <input type="checkbox" id="sub-verbose" value="verbose" onchange="updateSubroutines()">
                                    <strong>DETAIL Verbose Mode</strong> - Detailed, thorough explanations
                                </label>
                            </div>
                        </fieldset>
                        
                        <div class="field-row-stacked" style="margin-top: 16px; padding: 8px; background: #ffffc0; border: 1px solid #808080;">
                            <label style="font-weight: bold;">‚ÑπÔ∏è Active Instructions:</label>
                            <div id="active-instructions" style="font-size: 10px; margin-top: 6px; color: #000;">
                                No subroutines selected
                            </div>
                        </div>
                        
                        <div class="field-row" style="justify-content: space-between; margin-top: 16px;">
                            <button onclick="clearAllSubroutines()">Clear All</button>
                            <button onclick="applySubroutines()" style="font-weight: bold;">Apply Changes</button>
                        </div>
                    </div>
                </article>

                <!-- Settings Tab -->
                <article role="tabpanel" id="tab-settings" style="display: none;">
                    <div class="settings-container">
                        <fieldset>
                            <legend>Generation Parameters</legend>
                            <div class="field-row">
                                <label for="temperature">Temperature:</label>
                                <input id="temperature" type="range" min="0" max="2" step="0.1" value="0.8" />
                                <span id="temp-value">0.8</span>
                            </div>
                            <div class="field-row">
                                <label for="max-tokens">Max Tokens:</label>
                                <input id="max-tokens" type="number" min="1" max="4096" value="512" />
                            </div>
                            <div class="field-row">
                                <label for="top-p">Top P:</label>
                                <input id="top-p" type="range" min="0" max="1" step="0.05" value="0.9" />
                                <span id="top-p-value">0.9</span>
                            </div>
                            <div class="field-row">
                                <label for="top-k">Top K:</label>
                                <input id="top-k" type="number" min="1" max="100" value="40" />
                            </div>
                        </fieldset>
                        <fieldset style="margin-top: 12px;">
                            <legend>Audio</legend>
                            <div class="field-row" style="position: relative;">
                                <button id="voice-menu-btn" onclick="toggleVoiceMenu(event)" style="min-width: 120px;">üîä Voice ‚ñº</button>
                                <label style="margin-left: 8px; font-size: 10px; color: #666;">Microsoft Sam style announcements</label>
                                
                                <!-- Voice Control Dropdown Menu -->
                                <div id="voice-menu" class="win95-menu" style="display: none;">
                                    <div class="menu-item" onclick="toggleVoiceOnOff()">
                                        <span id="voice-check">‚úì</span> Voice Enabled
                                    </div>
                                    <div class="menu-separator"></div>
                                    <div class="menu-item" onclick="testVoice()">üé§ Test Voice</div>
                                    <div class="menu-separator"></div>
                                    <div class="menu-item" onclick="setVoiceRate(0.8)">‚è™ Slower</div>
                                    <div class="menu-item" onclick="setVoiceRate(1.0)">‚ñ∂Ô∏è Normal Speed</div>
                                    <div class="menu-item" onclick="setVoiceRate(1.3)">‚è© Faster</div>
                                </div>
                            </div>
                        </fieldset>
                        <div class="field-row" style="justify-content: flex-end; margin-top: 10px;">
                            <button onclick="resetSettings()">Reset to Defaults</button>
                            <button onclick="saveSettings()">Save Settings</button>
                        </div>
                    </div>
                </article>
            </section>

            <!-- Voice Control Bar -->
            <section style="margin-top: 8px;">
                <div style="display: flex; align-items: center; gap: 8px; padding: 4px 0;">
                    <button id="quick-voice-toggle" onclick="quickToggleVoice()" style="min-width: 100px; font-size: 11px;">üîä Voice On</button>
                    <span style="font-size: 10px; color: #666;">Quick mute/unmute</span>
                </div>
            </section>

            <!-- API Commands Reference -->
            <section style="margin-top: 8px;">
                <div class="sunken-panel" style="padding: 8px; background: #c0c0c0;">
                    <div style="font-weight: bold; margin-bottom: 6px; font-size: 11px;">API Commands:</div>
                    <div style="font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.6;">
                        <div><strong>Health:</strong> GET /health</div>
                        <div><strong>Prompt:</strong> POST /prompt {"prompt": "text", "temperature": 0.8}</div>
                        <div><strong>Stream:</strong> POST /stream {"prompt": "text"}</div>
                        <div><strong>Models:</strong> GET /list-models</div>
                        <div><strong>Start Instance:</strong> POST /start-instance {"instance_id": "id", "port": 8001, "model": "model.gguf"}</div>
                        <div><strong>Stop Instance:</strong> POST /stop-instance {"instance_id": "id", "port": 8001}</div>
                    </div>
                </div>
            </section>
        </div>
        <div class="status-bar">
            <p class="status-bar-field">Ready</p>
            <p class="status-bar-field">API: <span id="api-endpoint">http://localhost:8001</span></p>
        </div>
    </div>
    </div>
    </div>

    <!-- Add Instance Dialog -->
    <div id="add-instance-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-window">
            <div class="title-bar">
                <div class="title-bar-text">Add Instance</div>
                <div class="title-bar-controls">
                    <button aria-label="Close" onclick="closeAddInstanceDialog()"></button>
                </div>
            </div>
            <div class="window-body">
                <div class="field-row-stacked">
                    <label>
                        <input type="radio" name="instance-type" value="new" checked onchange="toggleInstanceType()"> 
                        Create New Instance
                    </label>
                    <label>
                        <input type="radio" name="instance-type" value="custom" onchange="toggleInstanceType()"> 
                        Connect to Existing Instance
                    </label>
                </div>
                
                <div id="new-instance-fields">
                    <div class="field-row">
                        <label for="instance-name">Name:</label>
                        <input id="instance-name" type="text" placeholder="My LLM Instance" />
                    </div>
                    <div class="field-row">
                        <label for="instance-port">Port:</label>
                        <input id="instance-port" type="number" min="8000" max="9999" value="8002" />
                    </div>
                    <div class="field-row">
                        <label for="instance-model">Model:</label>
                        <select id="instance-model">
                            <option value="">Select model...</option>
                        </select>
                    </div>
                    
                    <fieldset style="margin-top: 12px;">
                        <legend>Subroutines</legend>
                        <div class="field-row-stacked" style="padding: 8px;">
                            <label>
                                <input type="checkbox" id="subroutine-json" value="json">
                                JSON Output - Always return valid JSON format
                            </label>
                            <label>
                                <input type="checkbox" id="subroutine-xml" value="xml">
                                XML Output - Return responses in XML format
                            </label>
                            <label>
                                <input type="checkbox" id="subroutine-markdown" value="markdown">
                                Markdown Output - Format responses in markdown
                            </label>
                            <label>
                                <input type="checkbox" id="subroutine-code" value="code">
                                Code-Only - Return only code without explanations
                            </label>
                            <label>
                                <input type="checkbox" id="subroutine-concise" value="concise">
                                Concise Mode - Brief, direct answers only
                            </label>
                            <label>
                                <input type="checkbox" id="subroutine-verbose" value="verbose">
                                Verbose Mode - Detailed, thorough explanations
                            </label>
                        </div>
                    </fieldset>
                </div>
                
                <div id="custom-instance-fields" style="display: none;">
                    <div class="field-row">
                        <label for="custom-name">Name:</label>
                        <input id="custom-name" type="text" placeholder="Remote Server" />
                    </div>
                    <div class="field-row">
                        <label for="custom-url">URL:</label>
                        <input id="custom-url" type="text" placeholder="http://192.168.1.100:8001" />
                    </div>
                </div>
                
                <div class="field-row" style="justify-content: flex-end; margin-top: 16px; gap: 8px;">
                    <button onclick="closeAddInstanceDialog()">Cancel</button>
                    <button onclick="addInstance()">Add Instance</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js?v=2"></script>
</body>
</html>
